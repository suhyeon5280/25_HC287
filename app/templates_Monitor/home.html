<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pupilot - í™ˆ (Flask ì—°ë™)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .hidden { display: none; }
    
    /* ============================================== */
    /* âœ… 16:9 ë¹„ìœ¨ ë° App ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ (ìœ ì§€) */
    /* ============================================== */
    #app-container {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        background-color: #f9fafb;
    }
    #app.aspect-16-9 {
        width: 100vh;
        max-width: 100vw;
        aspect-ratio: 16 / 9;
        height: auto;
        position: relative;
        /* ê¸°ì¡´ home.htmlì˜ ë°°ê²½ìƒ‰ ìœ ì§€ */
        background-color: white; 
    }
    /* ë¯¸ë””ì–´ ì¿¼ë¦¬ ìƒëµ (ì´ì „ ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìœ ì§€ë¨) */
    
    .search-results {
      position: absolute; top: 100%; left: 0; right: 0;
      background-color: white; border: 1px solid #e2e8f0;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      z-index: 10; max-height: 200px; overflow-y: auto;
    }
    /* ============================================== */
    /* âœ… ìƒˆë¡œìš´ í‚¤ë³´ë“œ ë””ìì¸ CSS (ìœ ì§€) */
    /* ============================================== */
    #customKeyboardContainer {
        position: absolute; /* fixed ëŒ€ì‹  absoluteë¡œ app ì»¨í…Œì´ë„ˆ í•˜ë‹¨ì— ê³ ì • */
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 98%; /* 16:9 í™”ë©´ í­ì˜ 98% ì‚¬ìš© */
        max-width: 600px; 
        
        background: #f0f0f0; /* ë°°ê²½ìƒ‰ í†µì¼ */
        box-shadow: 0 -6px 20px rgba(0,0,0,0.1);
        border-radius: 12px 12px 0 0;
        padding: 8px 6px; /* padding ì¡°ì • */
        z-index: 99;
    }

    .keyboard-row {
      display: flex;
      justify-content: center;
      gap: 4px; /* ê°„ê²© í†µì¼ */
      margin-bottom: 4px;
    }

    .keyboard-key {
      flex-grow: 1;
      height: 52px; /* h-12ì™€ ìœ ì‚¬í•˜ê²Œ ì¡°ì • */
      border-radius: 8px; /* ëª¨ì„œë¦¬ ë¶€ë“œëŸ½ê²Œ */
      background: linear-gradient(145deg, #ffffff, #f1f5f9);
      border: 1px solid #d1d5db;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
      font-size: 1.1rem; /* í°íŠ¸ í¬ê¸° ì¡°ì • */
      font-weight: 600;
      color: #111827;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      transition: all 0.12s ease-in-out;
    }
    .keyboard-key:active {
      background: #e2e8f0;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
      transform: scale(0.97);
    }
    .keyboard-key.func-key {
      /* ì•± í…Œë§ˆ ì»¬ëŸ¬ (Teal) ì‚¬ìš© */
      background: #2dd4bf; /* teal-400 */
      color: black;
      font-weight: 700;
      border: 1px solid #0d9488;
    }
    .keyboard-key.func-key:active {
      background: #0d9488; /* teal-700 */
      color: white;
    }
    .keyboard-key.num-key {
        background: #e5e7eb; /* gray-200 */
        border: 1px solid #a1a1aa; /* gray-400 */
    }

    /* í‚¤ ë¹„ìœ¨ ì¬ì¡°ì • */
    .keyboard-row:nth-child(3) { /* ASDFG ì¤„ ë“¤ì—¬ì“°ê¸° */
        margin-left: 5%; 
        width: 95%;
    }
    /* Function/Space Key ë¹„ìœ¨ ì„¤ì • */
    .keyboard-row:nth-child(5) .keyboard-key:nth-child(2) { /* Space */
      flex-grow: 5.8; /* ê¸°ì¡´ home.htmlì˜ Space ë¹„ìœ¨ ìœ ì§€ */
      font-size: 1.1rem;
    }
    .keyboard-row:nth-child(5) .keyboard-key:first-child, /* Hide */
    .keyboard-row:nth-child(5) .keyboard-key:last-child { /* Search */
      flex-grow: 1.5; /* ê¸°ëŠ¥ í‚¤ ë¹„ìœ¨ ìœ ì§€ */
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="app-container">
    <div id="app" class="bg-white min-h-screen aspect-16-9">
      <div class="p-4 pb-20">
        <div class="space-y-6">
          <div class="bg-teal-400 rounded-2xl p-6 text-center">
            <img src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/pupilot-logo-9jkjboTGvHXXxkQFDbjqxEAdNTI4e0.png"
                 alt="Pupilot" class="h-12 mx-auto mb-4" />

            <div class="relative w-full mb-4">
              <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"
                   fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
              <input type="text" id="addressInput"
                     placeholder="ì›í•˜ëŠ” ëª©ì ì§€ë¥¼ ê²€ìƒ‰í•´ì£¼ì„¸ìš”"
                     class="pl-10 bg-white rounded-full w-full py-2 px-4"
                     autocomplete="off" readonly/> 
              <div id="searchResults" class="search-results hidden"
                   role="listbox" aria-label="ê²€ìƒ‰ ê²°ê³¼"></div>
            </div>

            <div class="flex gap-2 mt-4">
              <button class="bg-white text-black hover:bg-gray-100 rounded-full px-3 py-1 text-sm">
                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
              </button>
              <button class="bg-white text-black hover:bg-gray-100 rounded-full px-3 py-1 text-sm">ì§‘</button>
              <a href="/navigation.html" class="bg-white text-black hover:bg-gray-100 rounded-full px-3 py-1 text-sm">ê³µì›</a>
            </div>
          </div>

          <div class="card p-4">
            <div class="flex justify-between items-center mb-4">
              <button onclick="changeMonth(-1)" class="p-2 rounded-full hover:bg-gray-100">â—€</button>
              <div id="currentMonthYear" class="text-lg font-semibold"></div>
              <button onclick="changeMonth(1)" class="p-2 rounded-full hover:bg-gray-100">â–¶</button>
            </div>
            <div class="grid grid-cols-7 gap-1 mb-2">
              <div class="text-center text-sm font-medium text-red-500 py-2">SUN</div>
              <div class="text-center text-sm font-medium py-2">MON</div>
              <div class="text-center text-sm font-medium py-2">TUE</div>
              <div class="text-center text-sm font-medium py-2">WED</div>
              <div class="text-center text-sm font-medium py-2">THU</div>
              <div class="text-center text-sm font-medium py-2">FRI</div>
              <div class="text-center text-sm font-medium py-2">SAT</div>
            </div>
            <div id="calendarDays" class="grid grid-cols-7 gap-1"></div>
          </div>
        </div>
      </div>

      <div id="bottomNav" class="fixed bottom-0 left-1/2 transform -translate-x-1/2
                                 w-full bg-teal-400 rounded-t-2xl">
        <div class="flex justify-around py-3">
          <a href="/report.html" class="flex flex-col items-center gap-1 text-black/70 hover:text-white">
            ğŸ“Š
          </a>
          <a href="/home.html" class="flex flex-col items-center gap-1 text-white hover:text-white">
            ğŸ“…
          </a>
          <a href="/profile.html" class="flex flex-col items-center gap-1 text-black/70 hover:text-white">
            ğŸ‘¤
          </a>
        </div>
      </div>
      
      <div id="customKeyboardContainer" class="hidden">
        <div id="keyboard">
          <div class="keyboard-row">
            <button class="keyboard-key num-key" data-char="1" data-type="num">1</button>
            <button class="keyboard-key num-key" data-char="2" data-type="num">2</button>
            <button class="keyboard-key num-key" data-char="3" data-type="num">3</button>
            <button class="keyboard-key num-key" data-char="4" data-type="num">4</button>
            <button class="keyboard-key num-key" data-char="5" data-type="num">5</button>
            <button class="keyboard-key num-key" data-char="6" data-type="num">6</button>
            <button class="keyboard-key num-key" data-char="7" data-type="num">7</button>
            <button class="keyboard-key num-key" data-char="8" data-type="num">8</button>
            <button class="keyboard-key num-key" data-char="9" data-type="num">9</button>
            <button class="keyboard-key num-key" data-char="0" data-type="num">0</button>
          </div>

          <div class="keyboard-row">
            <button class="keyboard-key" data-char="q">q</button>
            <button class="keyboard-key" data-char="w">w</button>
            <button class="keyboard-key" data-char="e">e</button>
            <button class="keyboard-key" data-char="r">r</button>
            <button class="keyboard-key" data-char="t">t</button>
            <button class="keyboard-key" data-char="y">y</button>
            <button class="keyboard-key" data-char="u">u</button>
            <button class="keyboard-key" data-char="i">i</button>
            <button class="keyboard-key" data-char="o">o</button>
            <button class="keyboard-key" data-char="p">p</button>
          </div>

          <div class="keyboard-row" style="margin-left: 5%; width: 95%;">
            <button class="keyboard-key" data-char="a">a</button>
            <button class="keyboard-key" data-char="s">s</button>
            <button class="keyboard-key" data-char="d">d</button>
            <button class="keyboard-key" data-char="f">f</button>
            <button class="keyboard-key" data-char="g">g</button>
            <button class="keyboard-key" data-char="h">h</button>
            <button class="keyboard-key" data-char="j">j</button>
            <button class="keyboard-key" data-char="k">k</button>
            <button class="keyboard-key" data-char="l">l</button>
          </div>

          <div class="keyboard-row">
            <button class="keyboard-key func-key" id="toggleLang" data-action="toggle" style="flex-grow: 1.5;">í•œ/A</button>
            <button class="keyboard-key" data-char="z">z</button>
            <button class="keyboard-key" data-char="x">x</button>
            <button class="keyboard-key" data-char="c">c</button>
            <button class="keyboard-key" data-char="v">v</button>
            <button class="keyboard-key" data-char="b">b</button>
            <button class="keyboard-key" data-char="n">n</button>
            <button class="keyboard-key" data-char="m">m</button>
            <button class="keyboard-key func-key" data-action="backspace" style="flex-grow: 1.5;">DEL</button>
          </div>

          <div class="keyboard-row">
            <button class="keyboard-key func-key" data-action="hide" style="flex-grow: 1.5;">ìˆ¨ê¸°ê¸°</button>
            <button class="keyboard-key" data-char=" " data-action="space" style="flex-grow: 5.8;">Space</button>
            <button class="keyboard-key func-key" data-action="search" style="flex-grow: 1.5;">ê²€ìƒ‰</button>
          </div>
        </div>
      </div>
      </div>
  </div>

  <script>
    const addressInput = document.getElementById('addressInput');
    const searchResults = document.getElementById('searchResults');
    const keyboardContainer = document.getElementById('customKeyboardContainer');
    const toggleLangButton = document.getElementById('toggleLang');
    const keyButtons = document.querySelectorAll('#keyboard .keyboard-key[data-char]');
    
    let isKorean = true;
    let currentInput = addressInput; 
    
    // ===============================================
    // âœ… í•œê¸€ ì¡°í•© ë¡œì§ (ìœ ì§€)
    // ===============================================
    const CHOSEONG = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
    const JUNGSEONG = ['ã…', 'ã…', 'ã…‘', 'ã…’', 'ã…“', 'ã…”', 'ã…•', 'ã…–', 'ã…—', ['ã…—', 'ã…'], ['ã…—', 'ã…'], ['ã…—', 'ã…£'], 'ã…›', 'ã…œ', ['ã…œ', 'ã…“'], ['ã…œ', 'ã…”'], ['ã…œ', 'ã…£'], 'ã… ', 'ã…¡', ['ã…¡', 'ã…£'], 'ã…£'];
    const JONGSEONG = ['', 'ã„±', 'ã„²', 'ã„³', 'ã„´', 'ã„µ', 'ã„¶', 'ã„·', 'ã„¹', 'ã„º', 'ã„»', 'ã„¼', 'ã„½', 'ã„¾', 'ã„¿', 'ã…€', 'ã…', 'ã…‚', 'ã…„', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
    
    const HangulMap = {
        'q': { kor: 'ã…‚', type: 'c' }, 'w': { kor: 'ã…ˆ', type: 'c' }, 'e': { kor: 'ã„·', type: 'c' }, 'r': { kor: 'ã„±', type: 'c' }, 't': { kor: 'ã……', type: 'c' },
        'y': { kor: 'ã…›', type: 'v' }, 'u': { kor: 'ã…•', type: 'v' }, 'i': { kor: 'ã…‘', type: 'v' }, 'o': { kor: 'ã…', type: 'v' }, 'p': { kor: 'ã…”', type: 'v' },
        'a': { kor: 'ã…', type: 'c' }, 's': { kor: 'ã„´', type: 'c' }, 'd': { kor: 'ã…‡', type: 'c' }, 'f': { kor: 'ã„¹', type: 'c' }, 'g': { kor: 'ã…', type: 'c' },
        'h': { kor: 'ã…—', type: 'v' }, 'j': { kor: 'ã…“', type: 'v' }, 'k': { kor: 'ã…', type: 'v' }, 'l': { kor: 'ã…£', type: 'v' },
        'z': { kor: 'ã…‹', type: 'c' }, 'x': { kor: 'ã…Œ', type: 'c' }, 'c': { kor: 'ã…Š', type: 'c' }, 'v': { kor: 'ã…', type: 'c' }, 'b': { kor: 'ã… ', type: 'v' },
        'n': { kor: 'ã…œ', type: 'v' }, 'm': { kor: 'ã…¡', type: 'v' },
    };

    const KorIndexMap = {
        'ã„±': 0, 'ã„²': 1, 'ã„´': 2, 'ã„·': 3, 'ã„¸': 4, 'ã„¹': 5, 'ã…': 6, 'ã…‚': 7, 'ã…ƒ': 8, 'ã……': 9, 'ã…†': 10, 'ã…‡': 11, 'ã…ˆ': 12, 'ã…‰': 13, 'ã…Š': 14, 'ã…‹': 15, 'ã…Œ': 16, 'ã…': 17, 'ã…': 18,
        'ã…': 0, 'ã…': 1, 'ã…‘': 2, 'ã…’': 3, 'ã…“': 4, 'ã…”': 5, 'ã…•': 6, 'ã…–': 7, 'ã…—': 8, 'ã…›': 12, 'ã…œ': 13, 'ã… ': 17, 'ã…¡': 18, 'ã…£': 20,
    };
    
    let composing = { chosung: -1, jungseong: -1, jongseong: -1 };
    
    function composeHangul() {
        if (composing.chosung === -1) return '';
        let charCode = 0xAC00;
        charCode += composing.chosung * 588;
        if (composing.jungseong !== -1) {
            charCode += KorIndexMap[JUNGSEONG[composing.jungseong]] * 28;
        } else {
            return CHOSEONG[composing.chosung];
        }
        if (composing.jongseong !== -1) {
            charCode += composing.jongseong;
        }
        return String.fromCharCode(charCode);
    }
    
    function commitChar(char) {
        currentInput.value += char;
        composing = { chosung: -1, jungseong: -1, jongseong: -1 };
        performSearch(currentInput.value);
    }
    
    function processHangulInput(korChar) {
        const charType = HangulMap[Object.keys(HangulMap).find(key => HangulMap[key].kor === korChar)]?.type;
        if (!charType) return;
        
        const cIndex = CHOSEONG.indexOf(korChar);
        const vIndex = JUNGSEONG.findIndex(j => j === korChar);
        
        if (charType === 'c') { // ììŒ ì…ë ¥
            if (composing.jungseong === -1) {
                if (composing.chosung !== -1) commitChar(CHOSEONG[composing.chosung]);
                composing.chosung = cIndex;
            } else if (composing.jongseong === -1) {
                const JongKey = JONGSEONG.indexOf(korChar);
                if (JongKey !== -1) composing.jongseong = JongKey;
                else { currentInput.value = currentInput.value.slice(0, -1) + composeHangul(); composing = { chosung: cIndex, jungseong: -1, jongseong: -1 }; }
            } else {
                currentInput.value = currentInput.value.slice(0, -1) + composeHangul();
                composing = { chosung: cIndex, jungseong: -1, jongseong: -1 };
            }
        } else { // ëª¨ìŒ ì…ë ¥
            if (composing.chosung === -1) commitChar(korChar);
            else if (composing.jungseong === -1) composing.jungseong = vIndex;
            else if (composing.jongseong !== -1) {
                currentInput.value = currentInput.value.slice(0, -1) + composeHangul();
                composing = { chosung: KorIndexMap[JONGSEONG[composing.jongseong]], jungseong: vIndex, jongseong: -1 };
            } else {
                 currentInput.value = currentInput.value.slice(0, -1) + composeHangul();
                 composing = { chosung: 11, jungseong: vIndex, jongseong: -1 };
            }
        }
        
        // ******************************************************************************
        // âœ… [í•µì‹¬ ìˆ˜ì •]: ì¡°í•© ì¤‘ì¸ ê¸€ìë¥¼ currentInput.valueì— ê¹”ë”í•˜ê²Œ ë°˜ì˜ (ì´ì „ ë¬¸ì œ í•´ê²°)
        // ******************************************************************************
        if (composing.chosung !== -1) {
            const composed = composeHangul();
            
            // 1. í˜„ì¬ inputì˜ ë§ˆì§€ë§‰ ê¸€ìê°€ ì¡°í•© ì¤‘ì¸ ì´ˆì„±ì´ì—ˆë‹¤ë©´, ê·¸ ì´ˆì„±ì„ ì§€ìš°ê³  ì™„ì„±ëœ ê¸€ìë¡œ ëŒ€ì²´
            const lastChar = currentInput.value.slice(-1);
            if (CHOSEONG.includes(lastChar) && CHOSEONG.indexOf(lastChar) === composing.chosung) {
                 currentInput.value = currentInput.value.slice(0, -1) + composed;
            } 
            // 2. í˜„ì¬ ê¸€ìê°€ ì™„ì„±ëœ í•œê¸€ì´ê±°ë‚˜ ì¡°í•© ì¤‘ì¸ ìƒíƒœë¼ë©´, ë§ˆì§€ë§‰ ê¸€ìë¥¼ ì§€ìš°ê³  ìƒˆ ì™„ì„± ê¸€ìë¡œ ëŒ€ì²´
            else if (composing.jungseong !== -1 || composing.jongseong !== -1) {
                 // ë§ˆì§€ë§‰ ê¸€ìê°€ ì™„ì„±í˜• í•œê¸€ì´ì—ˆë‹¤ë©´, ê·¸ê²ƒì„ ì§€ìš°ê³  í˜„ì¬ ì¡°í•© ì¤‘ì¸ ê¸€ìë¡œ ëŒ€ì²´
                 // (ì´ ë¶€ë¶„ì´ ì¤‘ë³µ ì…ë ¥ì„ ì¼ìœ¼í‚¤ëŠ” ë³µì¡í•œ ë¶€ë¶„ì´ì—ˆìŒ)
                 // ë” ì•ˆì „í•œ ë°©ë²•: ë§ˆì§€ë§‰ ê¸€ìê°€ í•œê¸€ ì™„ì„±í˜• ì½”ë“œ(0xAC00 ~ 0xD7A3) ë²”ìœ„ì— ìˆìœ¼ë©´ ì‚­ì œ í›„ ì¶”ê°€
                 const lastCharCode = currentInput.value.charCodeAt(currentInput.value.length - 1);
                 if (lastCharCode >= 0xAC00 && lastCharCode <= 0xD7A3) {
                      currentInput.value = currentInput.value.slice(0, -1) + composed;
                 } else {
                      // ë§ˆì§€ë§‰ ê¸€ìê°€ ì™„ì„±í˜•ì´ ì•„ë‹Œ ê²½ìš° (ì˜ˆ: ê³µë°±ì´ë‚˜ ì˜ì–´), ê·¸ëƒ¥ ì¶”ê°€
                      currentInput.value += composed;
                 }
            } else {
                // ì´ˆì„±ë§Œ ì…ë ¥ëœ ìƒíƒœ (ë‹¨ë… ììŒ)
                currentInput.value += composed;
            }
        }
        // ******************************************************************************
        
        performSearch(currentInput.value);
    }
    
    function processDelete() {
        if (composing.chosung !== -1) {
            if (composing.jongseong !== -1) composing.jongseong = -1;
            else if (composing.jungseong !== -1) composing.jungseong = -1;
            else composing.chosung = -1;
            
            // âœ… [í•µì‹¬ ìˆ˜ì •]: ë§ˆì§€ë§‰ ê¸€ìë¥¼ ì§€ìš°ê³ , ì¡°í•© ì¤‘ì¸ ìƒíƒœì˜ ê¸€ìë¡œ ëŒ€ì²´ (ì•ˆì •í™”)
            currentInput.value = currentInput.value.slice(0, -1);
            const composed = composeHangul();
            if (composed) currentInput.value += composed;
        } else if (currentInput.value.length > 0) {
            currentInput.value = currentInput.value.slice(0, -1);
        }
        performSearch(currentInput.value);
    }

    // ===============================================

    // 1. ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ì»¤ìŠ¤í…€ í‚¤ë³´ë“œ í‘œì‹œ (OS í‚¤ë³´ë“œ ë°©ì§€)
    addressInput.addEventListener('focus', function(e) {
        this.readOnly = true; 
        currentInput = this;
        keyboardContainer.classList.remove('hidden');
    });

    // 2. í‚¤ë³´ë“œ ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
    document.getElementById('keyboard').addEventListener('click', function(e) {
        const button = e.target.closest('.keyboard-key');
        if (!button || !currentInput) return;

        const char = button.getAttribute('data-char');
        const action = button.getAttribute('data-action');
        const type = button.getAttribute('data-type');
        
        if (type === 'num' || action === 'space') {
            commitChar(button.textContent.trim());
        } else if (char) {
            const charName = char.toLowerCase();
            const korChar = HangulMap[charName]?.kor;
            
            if (isKorean && korChar) {
                processHangulInput(korChar);
            } else {
                commitChar(button.textContent.trim().toLowerCase());
            }
        } else if (action === 'backspace') {
            isKorean ? processDelete() : currentInput.value = currentInput.value.slice(0, -1);
            performSearch(currentInput.value);
        } else if (action === 'search') {
            keyboardContainer.classList.add('hidden');
            currentInput.readOnly = false;
        } else if (action === 'hide') {
            keyboardContainer.classList.add('hidden');
            currentInput.readOnly = false;
        } else if (action === 'toggle') {
            isKorean = !isKorean;
            toggleLangButton.textContent = isKorean ? 'í•œ/A' : 'A/í•œ';
            composing = { chosung: -1, jungseong: -1, jongseong: -1 };
            updateKeyboardLayout();
        }
    });

    // 3. í‚¤ë³´ë“œ ë ˆì´ì•„ì›ƒ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (í•œì˜ ì „í™˜)
    function updateKeyboardLayout() {
        keyButtons.forEach(key => {
            const dataChar = key.getAttribute('data-char');
            const type = key.getAttribute('data-type');
            
            if (dataChar && type !== 'num') {
                const charName = dataChar.toLowerCase();
                const displayChar = isKorean ? HangulMap[charName]?.kor || charName : charName;
                key.textContent = displayChar;
            }
        });
    }

    // ì´ˆê¸° ë ˆì´ì•„ì›ƒ ì„¤ì • (ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹œ ì‹¤í–‰)
    updateKeyboardLayout();

    // 4. ê²€ìƒ‰ ë¡œì§ (ê¸°ì¡´ í•¨ìˆ˜ ì¬ì‚¬ìš©)
    async function performSearch(query) {
      query = query.trim();
      if (!query) {
        searchResults.classList.add('hidden');
        return;
      }
      try {
        const res = await fetch(`/search?query=${encodeURIComponent(query)}`);
        if (!res.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜');
        const data = await res.json();
        if (data.documents && data.documents.length > 0) {
          renderSearchResults(data.documents.slice(0, 5));
        } else {
          searchResults.classList.add('hidden');
        }
      } catch (err) {
        console.error('ê²€ìƒ‰ ì‹¤íŒ¨:', err);
        searchResults.classList.add('hidden');
      }
    }

    // ğŸ”¹ ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ (ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€)
    function renderSearchResults(results) {
        searchResults.innerHTML = '';
        results.forEach((result, idx) => {
            const item = document.createElement('div');
            item.className = 'search-result-item';
            item.setAttribute('role', 'option');
            item.setAttribute('data-idx', idx);
            item.textContent = `${result.place_name} (${result.address_name || ''})`;

            item.addEventListener('click', () => {
                addressInput.value = result.place_name;
                searchResults.classList.add('hidden');
                const destination = {
                    name: result.place_name,
                    lat: parseFloat(result.y),
                    lng: parseFloat(result.x)
                };
                localStorage.setItem('destination', JSON.stringify(destination));
                window.location.href = '/navigation.html';
            });

            searchResults.appendChild(item);
        });
        searchResults.classList.remove('hidden');
    }

    // ë‹¬ë ¥ ë¡œì§ (ê¸°ì¡´ í•¨ìˆ˜ë“¤ ìœ ì§€)
    let today = new Date();
    let currentMonth = today.getMonth();
    let currentYear = today.getFullYear();
    let selectedDates = [
      { year: 2025, month: 8, day: 6 },
      { year: 2025, month: 8, day: 7 }
    ];

    function renderCalendar() {
      const monthYearEl = document.getElementById('currentMonthYear');
      const daysEl = document.getElementById('calendarDays');
      const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
      const lastDayOfMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      monthYearEl.innerHTML = `${currentYear}ë…„ ${currentMonth + 1}ì›”`;
      daysEl.innerHTML = '';
      for (let i = 0; i < firstDayOfMonth; i++) {
        daysEl.innerHTML += `<div class="text-center py-2 text-sm text-gray-300"></div>`;
      }
      for (let day = 1; day <= lastDayOfMonth; day++) {
        let dayClass = 'hover:bg-gray-100 rounded-lg cursor-pointer';
        const isSelected = selectedDates.some(d => d.year === currentYear && d.month === currentMonth && d.day === day);
        if (isSelected) dayClass = 'bg-teal-400 text-white rounded-lg';
        daysEl.innerHTML += `<div class="text-center py-2 text-sm ${dayClass}">${day}</div>`;
      }
    }
    function changeMonth(step) {
      currentMonth += step;
      if (currentMonth > 11) { currentMonth = 0; currentYear++; }
      else if (currentMonth < 0) { currentMonth = 11; currentYear--; }
      renderCalendar();
    }
    window.onload = renderCalendar;
  </script>
</body>
</html>